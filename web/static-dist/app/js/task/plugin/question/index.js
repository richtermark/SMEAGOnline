webpackJsonp(["app/js/task/plugin/question/index"],{"00e30a58f14c77ba6f94":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n("b334fd7e4c5a19234db2"),l=i(r),s=n("2263e6049683267051db"),u=i(s),f=function(){function e(){a(this,e),this.$element=$("#task-question-plugin-form"),this.editor=null,this.validator=null,this.initEvent()}return o(e,[{key:"initEvent",value:function(){var e=this;this.$element.on("focusin",".expand-form-trigger",function(t){return e.expand()}),this.$element.on("click",".btn-primary",function(t){return e.save(t)}),this.$element.on("click",".collapse-form-btn",function(t){return e.collapse()})}},{key:"save",value:function(e){var t=this;if(e.preventDefault(),this.validator&&this.validator.form()){var n=$(e.currentTarget);n.attr("disabled","disabled");var i=u.default.channel("task.plugin.question");$.post(this.$element.attr("action"),this.$element.serialize()).done(function(e){(0,l.default)("success","提问成功"),i.publish("form.save",{html:e}),n.removeAttr("disabled"),t.collapse()}).fail(function(e){(0,l.default)("danger",e)})}}},{key:"expand",value:function(){var e=this;if(!this.$element.hasClass("form-expanded")){this.$element.addClass("form-expanded");var t=CKEDITOR.replace("question_content",{toolbar:"Simple",filebrowserImageUploadUrl:this.$element.find("#question_content").data("imageUploadUrl")});this.editor=t,this.validator=this.$element.validate({rules:{"question[title]":"required","question[content]":"required"},messages:{"question[title]":"请输入问题标题","question[content]":"请输入提问内容"}}),t.on("change",function(){e.$element.find('[name="question[content]"]').val(t.getData())}),t.on("blur",function(){e.$element.find('[name="question[content]"]').val(t.getData())}),this.$element.find(".js-detail-form-group").removeClass("hide")}}},{key:"collapse",value:function(){this.$element.removeClass("form-expanded"),this.editor&&this.editor.destroy(),this.$element.removeData("validator"),this.clear(),this.$element.find(".js-detail-form-group").addClass("hide")}},{key:"clear",value:function(){this.$element.find("input[type=text],textarea").each(function(){$(this).val("")})}}]),e}();t.default=f},0:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n("2263e6049683267051db"),l=i(r),s=n("00e30a58f14c77ba6f94"),u=i(s),f=n("d8c8273d605150f97e6e"),c=i(f),d=function(){function e(){a(this,e),this.$element=$(".question-pane"),this.$list=this.$element.find(".question-list-block"),this.$detail=this.$element.find(".question-detail-block"),this.form=new u.default,this.question=null,this.initEvent()}return o(e,[{key:"initEvent",value:function(){var e=this;this.$element.on("click",".js-redirect-question-detail",function(t){return e.onRedirectQuestion(t)});var t=l.default.channel("task.plugin.question");t.subscribe("form.save",function(t,n){e.$element.find('[data-role="list"]').prepend(t.html),e.$element.find(".empty-item").remove()}),t.subscribe("back-to-list",function(){return e.onBackList()})}},{key:"onRedirectQuestion",value:function(e){var t=$(e.currentTarget),n=t.data("url");this.question=new c.default(n),this.$list.hide(),this.$detail.show()}},{key:"onBackList",value:function(){this.question&&this.question.destroy(),this.$list.show(),this.$detail.hide()}}]),e}();new d},d8c8273d605150f97e6e:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n("b334fd7e4c5a19234db2"),l=i(r),s=n("2263e6049683267051db"),u=i(s),f=function(){function e(t){a(this,e),this.url=t,this.$element=$(".question-detail-block"),this.$form=null,this.validator=null,this.channel=u.default.channel("task.plugin.question"),this.render()}return o(e,[{key:"initEvent",value:function(){var e=this;this.$element.on("click",".back-to-list",function(){e.channel.publish("back-to-list")}),this.$form.on("click",".btn-primary",function(t){return e.onSavePost(t)})}},{key:"onSavePost",value:function(e){var t=this;e.preventDefault(),this.validator&&this.validator.form()&&$.post(this.$form.attr("action"),this.$form.serialize()).done(function(e){t.$element.find("[data-role=post-list]").append(e);var n=parseInt(t.$element.find("[data-role=post-number]").text());t.$element.find("[data-role=post-number]").text(n+1),t.$form.find("textarea").val("")}).error(function(e){Notify.danger(e.error.message)})}},{key:"render",value:function(){var e=this;$.get(this.url).done(function(t){e.$element.html(t),e.$form=e.$element.find(".post-form"),e.validator=e.$form.validate({rules:{"post[content]":"required"},messages:{"post[content]":"请输入回复内容"}}),e.initEvent()}).fail(function(e){(0,l.default)("danger","error")})}},{key:"destroy",value:function(){this.$element.html(""),this.$element.undelegate()}}]),e}();t.default=f}});