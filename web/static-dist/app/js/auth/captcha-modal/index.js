webpackJsonp(["app/js/auth/captcha-modal/index"],{"0282bb17fb83bfbfed9b":function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),r=a("b334fd7e4c5a19234db2"),c=n(r),l=function(){function t(e){s(this,t),this.$element=$(e.element),this.validator=0,this.url=e.url?e.url:"",this.smsType=e.smsType?e.smsType:"",this.captchaNum=e.captchaNum?e.captchaNum:"captcha_num",this.captcha=!!e.captcha&&e.captcha,this.captchaValidated=!!e.captchaValidated&&e.captchaValidated,this.dataTo=e.dataTo?e.dataTo:"mobile",this.setup()}return i(t,[{key:"preSmsSend",value:function(){return!0}},{key:"setup",value:function(){this.captcha&&this.smsSend()}},{key:"postData",value:function(t,e){var a=this,n=function t(){var e=$("#js-time-left").html();$("#js-time-left").html(e-1),e-1>0?(a.$element.removeClass("disabled"),a.$element.addClass("disabled"),setTimeout(t,1e3)):($("#js-time-left").html(""),$("#js-fetch-btn-text").html(Translator.trans("获取短信验证码")),a.$element.removeClass("disabled"))};return a.$element.addClass("disabled"),$.post(t,e,function(t){"undefined"!=typeof t.ACK&&"ok"==t.ACK?($("#js-time-left").html("120"),$("#js-fetch-btn-text").html(Translator.trans("秒后重新获取")),(0,c.default)("success",Translator.trans("发送短信成功")),n()):"undefined"!=typeof t.error?(0,c.default)("danger",t.error):(0,c.default)("danger",Translator.trans("发送短信失败，请联系管理员"))}),this}},{key:"smsSend",value:function(){var t=$("#js-time-left").html();if(t.length>0)return!1;var e=this.url,a={};return a.to=$('[name="'+this.dataTo+'"]').val(),a.sms_type=this.smsType,!(this.captcha&&(a.captcha_num=$('[name="'+this.captchaNum+'"]').val(),!this.captchaValidated))&&(a=$.extend(a,a),this.preSmsSend()&&this.postData(e,a),this)}}]),t}();e.default=l},"601020d4b7c53037d8f9":function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),r=a("0282bb17fb83bfbfed9b"),c=n(r),l=function(){function t(e,a,n,i){s(this,t),this.$element=e,this.dataTo=a,this.smsType=n,this.captchaNum=i,this.CaptchaValidator=null,this.init()}return i(t,[{key:"init",value:function(){var t=this;this.$element.on("click","#getcode_num",function(e){return t.changeCaptcha(e)}),$(".js-captcha-btn").click(function(e){return t.submitForm(e)}),this.initValidator()}},{key:"changeCaptcha",value:function(t){var e=$(t.currentTarget);e.attr("src",e.data("url")+"?"+Math.random())}},{key:"submitForm",value:function(){this.CaptchaValidator.form()&&this.$element.submit()}},{key:"initValidator",value:function(){var t=this;this._captchaValidated=!1,this.CaptchaValidator=this.$element.validate({onkeyup:!1,onfocusout:!1,rules:{captcha_num:{required:!0,alphanumeric:!0}},messages:{captcha_num:{required:Translator.trans("请输入验证码")}},submitHandler:function(e){$.get(t.$element.attr("action"),{value:$("#captcha_num_modal").val()},function(e){if(e.success){t.$element.parents(".modal").modal("hide"),t._captchaValidated=!0;new c.default({element:".js-sms-send",url:$(".js-sms-send").data("smsUrl"),smsType:t.smsType,dataTo:t.dataTo,captchaNum:t.captchaNum,captcha:!0,captchaValidated:t._captchaValidated,preSmsSend:function(){var t=!0;return t}});$(".js-sms-send").off("click")}else t._captchaValidated=!1,t.$element.find("#getcode_num").attr("src",$("#getcode_num").data("url")+"?"+Math.random()),t.$element.find(".help-block").html('<span class="color-danger">'+Translator.trans("验证码错误")+"</span>"),t.$element.find(".help-block").show()},"json")}}),$("#captcha_num_modal").keydown(function(e){13==e.keyCode&&t.CaptchaValidator.form()})}}]),t}();e.default=l},0:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}var s=a("601020d4b7c53037d8f9"),i=n(s),r="",c="",l="captcha_num";$('input[name="set_bind_emailOrMobile"]').length>0?(r="set_bind_emailOrMobile",c="sms_registration"):$('input[name="mobile"]').length>0?(r="mobile",c=$("#password-reset-by-mobile-form").length>0?"sms_forget_password":$("#settings-find-pay-password-form").length>0?"sms_forget_pay_password":"sms_bind"):(r=null==$('[name="verifiedMobile"]').val()?"emailOrMobile":"verifiedMobile",c="sms_registration"),$("#captcha-form").find("#getcode_num").attr("src",$("#getcode_num").data("url")+"?"+Math.random());new i.default($("#captcha-form"),r,c,l)}});