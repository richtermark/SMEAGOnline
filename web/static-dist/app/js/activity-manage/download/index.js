webpackJsonp(["app/js/activity-manage/download/index"],{fbf0b6283b62b602eb6b:function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),r=i("eca7a2561fa47d3f75f6"),s=a(r),o=i("b334fd7e4c5a19234db2"),d=(a(o),i("f324dbdea53170d5000f")),u=function(){function e(){n(this,e),this.$form=$("#step2-form"),this.validator2=null,this.firstName=$("#title").val(),this.initStep2Form(),this.bindEvent(),this.initFileChooser()}return l(e,[{key:"initStep2Form",value:function(){var e=this.$form.validate({rules:{title:{required:!0,maxlength:50,trim:!0,course_title:!0},link:"url",materials:"required"},messages:{link:"链接地址不正确",materials:"请上传或选择%display%"}});this.$form.data("validator",e)}},{key:"bindEvent",value:function(){var e=this;this.$form.on("click",".js-btn-delete",function(t){return e.itemDelete(t)}),this.$form.on("click",".js-video-import",function(){return e.videoImport(!1)}),this.$form.on("click",".js-add-file-list",function(){return e.addFileBtn(!0)}),this.$form.on("blur","#title",function(t){return e.titleChange(t)})}},{key:"itemDelete",value:function(e){var t=$(e.currentTarget).closest("li"),i=t.data("id"),a=this.isEmpty($("#materials").val())?{}:JSON.parse($("#materials").val());a&&a[i]&&(delete a[i],$("#materials").val(JSON.stringify(a))),t.siblings("li").length<=0&&$("#materials").val(null),t.remove()}},{key:"videoImport",value:function(e){this.addFile(e)}},{key:"addFileBtn",value:function(e){this.addFile(e)}},{key:"initFileChooser",value:function(){var e=this,t=function(t){$("input[name=media]").val(JSON.stringify(t)),(0,d.chooserUiOpen)(),e.addFile(!1),e.firstName?$("#title").val(e.firstName):$("#title").val(""),$(".js-current-file").text(t.name)},i=new s.default;i.on("select",t)}},{key:"titleChange",value:function(e){var t=$(e.currentTarget);this.firstName=t.val()}},{key:"isEmpty",value:function(e){return null==e||""==e||void 0==e||0==Object.keys(e).length}},{key:"addFile",value:function(e){if($(".js-success-redmine").hide(),this.isEmpty($("#media").val())&&$("#step2-form").data("validator")&&$("#step2-form").data("validator").valid()&&$("#link").val().length>0){e||$("#verifyLink").val($("#link").val());var t={source:"link",id:$("#verifyLink").val(),name:$("#verifyLink").val(),link:$("#verifyLink").val(),summary:$("#file-summary").val(),size:0};$(".js-current-file").text($("#verifyLink").val()),$("#media").val(JSON.stringify(t))}var i=this.isEmpty($("#media").val())?{}:JSON.parse($("#media").val()),a=this.isEmpty($("#materials").val())?{}:JSON.parse($("#materials").val());if(!this.isEmpty(a)&&a[i.id])return $(".js-danger-redmine").text(Translator.trans("该文件已添加，请重新选择")).show(),setTimeout(function(){$(".js-danger-redmine").slideUp()},3e3),$(".js-current-file").text(""),$("#media").val(null),void(i=null);if(e){if(e&&this.isEmpty(i))return $(".js-danger-redmine").text(Translator.trans("请上传或选择要添加的资料")).show(),$(".js-current-file").text(""),void setTimeout(function(){$(".js-danger-redmine").slideUp()},3e3);$(".js-current-file").text(""),i.summary=$("#file-summary").val(),a[i.id]=i,$("#materials").val(JSON.stringify(a)),$("#media").val(null),$("#link").val(null),$("#file-summary").val(null),this.firstName||(this.firstName=i.name,$("#title").val(i.name));var n="";n=i.link?'\n    <li class="download-item " data-id="'+i.link+'">\n        <a class="gray-primary" href="'+i.link+'" target="_blank">'+i.name+'</a>\n        <a class="gray-primary phm btn-delete  js-btn-delete"  href="javascript:;"  data-url="" data-toggle="tooltip" data-placement="top" title="{{ \'删除\'|trans }}"><i class="es-icon es-icon-delete"></i></a>\n        <span class="glyphicon glyphicon-new-window text-muted text-sm" title="'+Translator.trans("删除")+'"></span>\n    </li>\n  ':'\n    <li class="download-item " data-id="'+i.id+'">\n      <a class="gray-primary" href="/materiallib/'+i.id+'/download">'+i.name+'</a>\n      <a class="gray-primary phm  btn-delete js-btn-delete" href="javascript:;"  data-url="" data-toggle="tooltip" data-placement="top" title="'+Translator.trans("删除")+'"><i class="es-icon es-icon-delete"></i></a>\n    </li>\n  ',$("#material-list").append(n),$('[data-toggle="tooltip"]').tooltip(),$(".file-browser-item").removeClass("active"),$(".js-danger-redmine").hide(),$(".js-success-redmine").text(Translator.trans("添加成功，可继续选择资料添加或点击下一步！")).show(),setTimeout(function(){$(".js-success-redmine").slideUp()},3e3),$(".jq-validate-error:visible").length>0&&$("#step2-form").data("validator").form()}}}]),e}();t.default=u},0:function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var n=i("fbf0b6283b62b602eb6b"),l=a(n);new l.default}});