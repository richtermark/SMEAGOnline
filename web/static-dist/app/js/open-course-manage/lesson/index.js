webpackJsonp(["app/js/open-course-manage/lesson/index"],[function(n,t,e){"use strict";function s(n){return n&&n.__esModule?n:{default:n}}function i(){var n=$(".lesson-manage-panel").data("file-status-url"),t=new Array;$(".lesson-list .item-lesson").each(function(){isNaN($(this).data("file-id"))||t.push($(this).data("file-id"))}),0!=t.length&&$.post(n,{ids:t.join(",")},function(n){if(n&&0!=n.length)for(var t=0;t<n.length;t++){var e=n[t];$.inArray(e.type,["video","ppt","document"])>-1&&("waiting"==e.convertStatus||"doing"==e.convertStatus?$("li[data-file-id="+e.id+"]").find('span[data-role="mediaStatus"]').append("<span class='text-warning'>(正在文件格式转换)</span>"):"error"==e.convertStatus?$("li[data-file-id="+e.id+"]").find('span[data-role="mediaStatus"]').append("<span class='text-danger'>(文件格式转换失败)</span>"):"success"==e.convertStatus&&($("li[data-file-id="+e.id+"]").find(".mark-manage").show(),$("li[data-file-id="+e.id+"]").find(".mark-manage-divider").show()))}})}function a(n,t){$.post(t.data("sortUrl"),{ids:n},function(n){var e=chapterNum=unitNum=0;t.find(".item-lesson, .item-chapter").each(function(){var n=$(this);n.hasClass("item-lesson")?(e++,n.find(".number").text(e)):n.hasClass("item-chapter-unit")?(unitNum++,n.find(".number").text(unitNum)):n.hasClass("item-chapter")&&(chapterNum++,unitNum=0,n.find(".number").text(chapterNum))})})}var o=e("8f840897d9471c8c1fbd"),r=s(o),d=e("b334fd7e4c5a19234db2"),l=s(d),c=$("#course-item-list");(0,r.default)({element:"#course-item-list",distance:20,itemSelector:".item-lesson, .item-chapter"},function(n){a(n,$("#course-item-list"))}),c.on("click",".delete-lesson-btn",function(n){if(confirm("删除课时的同时会删除课时的资料、测验。\n您真的要删除该课时吗？")){var t=$(n.currentTarget),e=function(){return t.parents(".item-chapter")[0]},s=function(){e()?t.parents(".item-chapter").remove():t.parents(".item-lesson").remove()};$.post($(this).data("url"),function(n){s(),a(c),$(".lesson-manage-panel").find(".only-one-lesson-notify").show(),$(".lesson-manage-panel").find("#lesson-create-btn").attr("disabled",!1),(0,l.default)("success","课时已删除！")},"json")}}),c.on("click",".delete-chapter-btn",function(n){var t=$(this).data("chapter"),e=$(this).data("part");if(confirm("您真的要删除该"+t+e+"吗？")){var s=$(n.currentTarget);$.post($(this).data("url"),function(n){s.parents(".item-chapter").remove(),a(c),(0,l.default)("success"+t+e+"已删除！")},"json")}}),c.on("click",".replay-lesson-btn",function(n){confirm("您真的要录制回放吗？")&&$.post($(this).data("url"),function(n){if(n.error)10019==n.error.code?(0,l.default)("danger","录制失败，直播时您没有进行录制！"):(0,l.default)("danger","录制失败！");else{var t="#"+$(n).attr("id");$(t).replaceWith(n),(0,l.default)("success","课时已录制！")}})}),c.on("click",".publish-lesson-btn",function(n){$(n.currentTarget);$.post($(this).data("url"),function(n){var t="#"+$(n).attr("id");$(t).find(".item-content .unpublish-warning").remove(),$(t).find(".item-actions .publish-lesson-btn").parent().addClass("hidden").removeClass("show"),$(t).find(".item-actions .unpublish-lesson-btn").parent().addClass("show").removeClass("hidden"),$(t).find(".item-actions .delete-lesson-btn").parent().addClass("hidden").removeClass("show"),$(t).find(".btn-link").tooltip(),(0,l.default)("success","课时发布成功！")})}),c.on("click",".unpublish-lesson-btn",function(n){$(n.currentTarget);$.post($(this).data("url"),function(n){var t="#"+$(n).attr("id");$(t).find(".item-content").append('<span class="unpublish-warning text-warning">(未发布)</span>'),$(t).find(".item-actions .publish-lesson-btn").parent().addClass("show").removeClass("hidden"),$(t).find(".item-actions .unpublish-lesson-btn").parent().addClass("hidden").removeClass("show"),$(t).find(".item-actions .delete-lesson-btn").parent().addClass("show").removeClass("hidden"),$(t).find(".btn-link").tooltip(),(0,l.default)("success","课时已取消发布！")})}),c.on("click",".delete-exercise-btn",function(n){if(confirm("您真的要删除该课时练习吗？")){$(n.currentTarget);$.post($(this).data("url"),function(n){(0,l.default)("success","练习已删除！"),window.location.reload()},"json")}}),c.on("click",".delete-homework-btn",function(n){if(confirm("您真的要删除该课时作业吗？")){$(n.currentTarget);$.post($(this).data("url"),function(n){(0,l.default)("success","作业已删除！"),window.location.reload()},"json")}}),$("#course-item-list .item-actions .btn-link").tooltip(),$("#course-item-list .fileDeletedLesson").tooltip(),$(".dropdown-menu").parent().on("shown.bs.dropdown",function(){"block"==$(this).find(".dropdown-menu-more").css("display")?($(this).parent().find(".dropdown-menu-more").mouseout(function(){$(this).parent().find(".dropdown-menu-more").hide()}),$(this).parent().find(".dropdown-menu-more").mouseover(function(){$(this).parent().find(".dropdown-menu-more").show()})):$(this).parent().find(".dropdown-menu-more").show()}),$(".dropdown-menu").parent().on("hide.bs.dropdown",function(){$(this).find(".dropdown-menu-more").show()}),i(),$("#lesson-create-btn").click(function(){var n=$(this).data("url");$.get(n,function(n){n.result?(0,l.default)("warning","公开课当前仅支持添加一个课时!"):($("#modal").html(n),$("#modal").modal("show"))})})}]);