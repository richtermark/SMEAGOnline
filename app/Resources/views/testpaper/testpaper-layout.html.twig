{% extends 'layout.html.twig' %}
{% block title %}{% if paperResult|default(null) %}{{ paperResult.paperName }}{% else %}{{ paper.name }}{% endif %} - {{ parent() }}{% endblock %}

{% if isIframeBody|default(1) %}
  {% set bodyClass = 'task-testpaper-body-iframe js-task-testpaper-body js-task-testpaper-body-iframe' %}
  {% set testpaperCardClass = 'js-testpaper-card affix mt20' %}
  {% set testpaperBodyClass = "mt20" %}
{% else %}
  {% set bodyClass = 'js-task-testpaper-body' %}
  {% set containerClass = 'mt20' %}
  {% set testpaperCardClass = 'js-testpaper-card' %}
{% endif %}


{% block body %}
  {% block header %}
    {% if showHeader|default(1) %}{{ parent() }}{% endif %}
  {% endblock %}

  {% if mobile %}
    {# fix mobile sofair #}
    <div class="iframe-parent-content">
  {% endif %}
  
  <div class="container {{containerClass|default('')}}">
    {% block paper_content %}
      <div class="row">
        <div class="col-md-9 prevent-copy">
          <div class="testpaper-body js-testpaper-body {{ testpaperBodyClass|default('') }} " data-copy="{{setting('course.testpaperCopy_enabled',0)}}">
            {% block paper_header %}
              <div class="es-section testpaper-heading js-testpaper-heading">
                <div class="testpaper-titlebar clearfix">
                  <h1 class="testpaper-title">
                    {% if paperResult|default(null) %}{{ paperResult.paperName }}{% else %}{{ paper.name }}{% endif %} <br>
                    <small class="text-sm">
                      {% if paperResult.status|default('doing') in ['reviewing','finished'] %}
                        {{'答题人：'|trans}}{{ student.nickname }} 
                        {{'交卷时间：'|trans}}{{ paperResult.endTime|date('Y-n-d H:i') }} 
                        {% if paperResult.beginTime != paperResult.usedTime %}
                          {{'用时：'|trans}}{{ paperResult.usedTime|duration_text }}
                        {% endif %}
                      {% endif %}
                    </small>
                  </h1>
                  <div class="testpaper-status">
                    {% if paperResult.status|default('doing') == 'doing' %}
                      <div class="label label-primary">{{'答题中'|trans}}</div>
                    {% elseif paperResult.status|default('doing') == 'reviewing' %}
                      <div class="label label-info">{{'批阅中'|trans}}</div>
                    {% else %}
                      <div class="label label-success">{{'批阅完成'|trans}}</div>
                    {% endif %}
                  </div>
                </div>

                {% block paper_description %}{% endblock %}
                {% block paper_result_bar %}{% endblock %}
                {% block paper_warning %}{% endblock %}
                {% block paper_question_type_bar %}{% endblock %}
              </div>
            {% endblock %}

            {% block paper_body %}
              {% include 'testpaper/do-test.html.twig' %}
            {% endblock %}
          </div>
        </div>
        <div class="col-md-3">
          {% block paper_sidebar %}{% endblock %}
        </div>
      </div>
    {% endblock %}
    {% block testpaper_finished_dialog %}
      <div id="testpaper-finished-dialog" class="modal in" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-body task-state-modal">
              <div class="title font-blod">
                <i class="es-icon es-icon-zanting1 color-warning"></i>
                {{'确认交卷'|trans}}
              </div>
              <div class="content">
                <div class="text-16">
                  {{'您真的要交卷吗？'|trans}}
                </div>
              </div>
              <div class="text-right mt20">
                <a href="javascript:;" class="btn btn-link" data-dismiss="modal">{{'取消'|trans}}</a>
                {% block finish_dialog_btn %}
                  <button class="btn btn-primary" id="testpaper-finish-btn" data-loading-text="{{'正在交卷, 请稍等'|trans}}..." data-role="paper-submit" data-url="{{ path('testpaper_finish', { resultId: paperResult.id|default(0) }) }}" data-goto="{{ path('testpaper_result_show', { resultId: paperResult.id|default(0) }) }}">
                  {{'确认交卷'|trans}}</button>
                {% endblock %}
              </div>
            </div>
          </div>
        </div>
      </div>
    {% endblock %}
    {% block timeout_dialog %}
      <div id="time-finish-dialog" class="modal fade" data-backdrop="static" tabindex="-1" role="dialog"  aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-body task-state-modal">
              <div class="title font-blod">
                <i class="es-icon es-icon-zanting1 color-warning"></i>{{'考试结束'|trans}}
              </div>
              <div class="content">
                <div class="text-16">
                  {{'考试已结束，您的试卷已提交，请点击下面的按钮查看结果！'|trans}}
                </div>
              </div>
              <div class="text-right mt20">
                {% if paperResult.id|default(0) > 0 %}
                  <a href="{{ path('testpaper_result_show', {resultId:paperResult.id|default(0)} ) }}" class="btn btn-info">{{'查看结果'|trans}}</a>
                {% else %}
                  <a href="javascript:;" class="btn btn-info" disabled="disabled">{{'查看结果'|trans}}</a>
                {% endif %}
                
              </div>
            </div>
          </div>
        </div>
      </div>
    {% endblock %}
    {% block testpaper_checked_dialog %}{% endblock %}
    {% block time_pause_dialog %}
      <div id="time-pause-dialog" class="modal fade" data-backdrop="static" tabindex="-1" role="dialog"  aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-body task-state-modal">
              <div class="title font-blod">
                <i class="es-icon es-icon-zanting1 color-warning"></i>{{'暂停'|trans}}
              </div>
              <div class="content">
                <div class="text-16">
                  {{'考试已暂停，请尽快回来哦！'|trans}}
                </div>
              </div>
              <div class="text-right mt20">
                <a class="btn btn-primary js-btn-resume" href="javascript:;">{{'继续考试'|trans}}</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    {% endblock %}
  </div>

  {% if mobile %}
    {# fix mobile sofair #}
    </div>
  {% endif %}

  {% block footer %}
    {% if showHeader|default(1) %}{{ parent() }}{% endif %}
  {% endblock %}

  {% if paperResult.id|default(0) > 0  and paperResult.status|default(null) == 'doing' %}
    <input type="hidden" name="testSuspend" data-url="{{ path('testpaper_do_suspend',{resultId:paperResult.id}) }}" />
  {% endif %}
  {% if not paperResult.id|default(0) %}
    <input type="hidden" name="preview" value="1" />
  {% endif %}
  <div id="login-modal" class="modal" data-url="{{ path('login_ajax') }}"></div>
  <div id="modal" class="modal"></div>
  <div id="attachment-modal" class="modal"></div>
{% endblock %}





